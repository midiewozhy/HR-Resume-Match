<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Website</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen text-xl">
    <div class="bg-white p-12 rounded-xl shadow-lg w-[600px] space-y-10">
        <h2 class="text-2xl font-bold text-blue-700 mb-6 text-center">简历匹配</h2>
        
        <!-- Output & Tasklog Area (side by side) -->
        <div class="flex space-x-12 w-full text-xl">
            <div class="flex-1">
                <label class="block text-gray-700 mb-3 text-xl">结果</label>
                <div id="outputArea" class="bg-gray-50 border rounded-lg p-10 h-80 overflow-auto w-full"></div>
            </div>
            <div class="flex-1">
                <label class="block text-gray-700 mb-3 text-xl">进程</label>
                <div id="tasklogArea" class="bg-gray-50 border rounded-lg p-10 h-80 overflow-auto w-full"></div>
            </div>
        </div>
        
        <!-- PDF Upload Area with icon and instruction -->
        <form id="uploadForm">
            <div>
                <label class="block text-gray-700 mb-3 text-xl">简历上传</label>
                <div class="flex items-center space-x-5 bg-gray-50 border rounded-lg p-5">
                    <!-- PDF Icon (Heroicons) -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 16v-4m0 0V8m0 4h4m-4 0H8m8 4v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h7l5 5v7a2 2 0 01-2 2h-1"/>
                    </svg>
                    <div class="flex-1">
                        <p class="text-gray-600 text-lg mb-2">请上传PDF文件</p>
                        <input id="resumePdf" type="file" accept="application/pdf" class="block w-full text-gray-700 border rounded-lg p-4 text-lg"/>
                    </div>
                </div>
            </div>
            
            <!-- Paper URLs Upload Area -->
            <div>
                <label class="block text-gray-700 mb-2 text-xl">论文1</label>
                <input id="paperUrl1" type="url" placeholder="第一篇论文（可选）" class="block w-full border rounded-lg p-4 mb-4 text-lg"/>
                <label class="block text-gray-700 mb-2 text-xl">论文2</label>
                <input id="paperUrl2" type="url" placeholder="第二篇论文（可选）" class="block w-full border rounded-lg p-4 text-lg"/>
            </div>
        </form>


        <!-- Buttons -->
        <div class="flex space-x-6">
            <button id="startBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-xl transition">
                开始任务
            </button>
            <button id="resetBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-xl text-xl transition">
                重置任务
            </button>
        </div>
    </div>
    <script>
        // 获取按钮元素
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const tasklogArea = document.getElementById('tasklogArea');
        const outputArea = document.getElementById('outputArea');

        // 定义一个addLog函数
        function addLog(message, type = 'info') {
            const timestamp = new Date();
            const timeString = timestamp.toLocaleTimeString();
            
            // 创建日志条目
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            
            // 设置图标
            let icon = 'ℹ️';
            switch(type) {
                case 'error': icon = '⚠️'; break;
                case 'success': icon = '✅'; break;
            }
            
            logEntry.innerHTML = `
                <div class="log-icon">${icon}</div>
                <div class="log-content">${message}</div>
            `;
            
            tasklogArea.appendChild(logEntry);
            
            // 自动滚动到底部
            tasklogArea.scrollTop = tasklogArea.scrollHeight;
        }

        // 为“开始任务”添加点击事件
        startBtn.addEventListener('click', function() {
            // 获取表单数据
            const formData = new FormData(document.getElementById('uploadForm'));

            // 检查是否上传了简历PDF
            if (!formData.has('resumePdf')) {
                addLog('好像没有上传简历哟，请上传后重试吧~', 'error');
                return;
            }

            // 开始任务提示
            addLog('开始处理候选热资料，请稍等...','info');

            // 调用后端函数处理
            fetch('http://localhost:5000/upload/pdf', {
                method: 'POST',
                body: formData.get('resumePdf')
            })

            // 处理响应
            .then(response => {
                return response.json().then(json => {
                    if (!response.ok) {
                        throw new Error(json.message || '上传失败');
                    }
                    return json;
                });
            })
            .then(data => {
                // 处理成功响应
                addLog('简历解析成功，马上进行分析匹配~', 'success');
                outputArea.textContent = data.resume_content || '没有提取到内容';
            })
            .catch(error => {
                // 统一处理错误：记录日志 + 显示用户友好提示
                console.error('上传失败:', error);
                // 显示面向用户的提示（避免暴露技术细节）
                // 显示给用户的提示（隐藏技术细节）
                const userMessage = '上传失败，请检查文件格式或稍后再试';
                addLog(userMessage, 'error');
            });


        });

    </script>
</body>
</html>
